var D=Object.defineProperty;var E=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var k=(i,s,a)=>s in i?D(i,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[s]=a,S=(i,s)=>{for(var a in s||(s={}))O.call(s,a)&&k(i,a,s[a]);if(E)for(var a of E(s))N.call(s,a)&&k(i,a,s[a]);return i};var c=(i,s,a)=>new Promise((w,f)=>{var g=t=>{try{r(a.next(t))}catch(d){f(d)}},C=t=>{try{r(a.throw(t))}catch(d){f(d)}},r=t=>t.done?w(t.value):Promise.resolve(t.value).then(g,C);r((a=a.apply(i,s)).next())});import{F as M}from"./Form-BDGu5wd6.js";import{u as U}from"./useForm-B328YeVm.js";import{u as W}from"./useValidator-Nt61Jv1p.js";import{g as $}from"./index-BXG4eBTJ.js";import"./index-B84MQcLW.js";/* empty css                  */import"./IconPicker-err_6xAG.js";/* empty css                        *//* empty css                    *//* empty css               */import{_ as j}from"./AddButtonPermission.vue_vue_type_script_setup_true_lang-CLMYIqKE.js";import{_ as q}from"./Button.vue_vue_type_script_setup_true_lang-CZ4yP6r2.js";import{ae as G,af as v,A as _,C as K,a3 as I,al as H,d as J}from"./element-plus-ByljZuZM.js";import{y as Q,r as V,W as L,u as h,O as o,a4 as y,I as x,w as X,z as Y,A as Z}from"./vue-chunks-DjkM_pWB.js";const be=Q({__name:"Write",props:{currentRow:{type:Object,default:()=>null}},setup(i,{expose:s}){const{required:a}=W(),w=i,f=l=>c(this,null,function*(){var n;const e=yield m();p({permissionList:(n=e==null?void 0:e.permissionList)==null?void 0:n.filter(P=>P.value!==l.value)})}),g=l=>c(this,null,function*(){t.value=S({},l)}),C=()=>c(this,null,function*(){var n;const l=yield m(),e=(n=l==null?void 0:l.permissionList)==null?void 0:n.findIndex(P=>P.id===t.value.id);e!==-1&&(l.permissionList[e]=S({},t.value),t.value=null)}),r=V(!1),t=V(null),d=L([{field:"type",label:"菜单类型",component:"RadioButton",value:0,colProps:{span:24},componentProps:{options:[{label:"目录",value:0},{label:"菜单",value:1}],on:{change:l=>c(this,null,function*(){const e=yield m();l===1?(u([{field:"component",path:"componentProps.disabled",value:!1}]),p({component:h(b)})):(u([{field:"component",path:"componentProps.disabled",value:!0}]),e.parentId===void 0?p({component:"#"}):p({component:"##"}))})}}},{field:"parentId",label:"父级菜单",component:"TreeSelect",componentProps:{nodeKey:"id",props:{label:"title",value:"id",children:"children"},highlightCurrent:!0,expandOnClickNode:!1,checkStrictly:!0,checkOnClickNode:!0,clearable:!0,on:{change:l=>c(this,null,function*(){var n;const e=yield m();l&&e.type===0?p({component:"##"}):!l&&e.type===0?p({component:"#"}):e.type===1&&p({component:(n=h(b))!=null?n:""})})}},optionApi:()=>c(this,null,function*(){return(yield $()).data.list||[]})},{field:"meta.title",label:"菜单名称",component:"Input"},{field:"component",label:"组件",component:"Input",value:"#",componentProps:{disabled:!0,placeholder:"#为顶级目录，##为子目录",on:{change:l=>{b.value=l}}}},{field:"name",label:"组件名称",component:"Input"},{field:"meta.icon",label:"图标",component:"Input"},{field:"path",label:"路径",component:"Input"},{field:"meta.activeMenu",label:"高亮菜单",component:"Input"},{field:"status",label:"状态",component:"Select",componentProps:{options:[{label:"禁用",value:0},{label:"启用",value:1}]}},{field:"permissionList",label:"按钮权限",component:"CheckboxGroup",colProps:{span:24},formItemProps:{slots:{default:l=>o(x,null,[o(q,{class:"m-t-5px",type:"primary",size:"small",onClick:()=>r.value=!0},{default:()=>[y("添加权限")]}),o(G,{data:l==null?void 0:l.permissionList},{default:()=>[o(v,{type:"index",prop:"id"},null),o(v,{prop:"value",label:"Value"},{default:({row:e})=>t.value&&t.value.id===e.id?o(_,{modelValue:t.value.value,"onUpdate:modelValue":n=>t.value.value=n,size:"small"},null):o("span",null,[e.value])}),o(v,{prop:"label",label:"Label"},{default:({row:e})=>t.value&&t.value.id===e.id?o(_,{modelValue:t.value.label,"onUpdate:modelValue":n=>t.value.label=n,size:"small"},null):o(K,{class:"mr-1",key:e.value},{default:()=>[e.label]})}),o(v,{label:"Operations",width:"180"},{default:({row:e})=>t.value&&t.value.id===e.id?o(I,{size:"small",type:"primary",onClick:C},{default:()=>[y("确定")]}):o(x,null,[o(I,{size:"small",type:"primary",onClick:()=>g(e)},{default:()=>[y("编辑")]}),o(H,{title:"Are you sure to delete this?",onConfirm:()=>f(e)},{reference:()=>o(I,{size:"small",type:"danger"},{default:()=>[y("删除")]})})])})]})])}}},{field:"meta.hidden",label:"是否隐藏",component:"Switch"},{field:"meta.alwaysShow",label:"是否一直显示",component:"Switch"},{field:"meta.noCache",label:"是否清除缓存",component:"Switch"},{field:"meta.breadcrumb",label:"是否显示面包屑",component:"Switch"},{field:"meta.affix",label:"是否固定在标签页",component:"Switch"},{field:"meta.noTagsView",label:"是否隐藏标签页",component:"Switch"},{field:"meta.canTo",label:"是否可跳转",component:"Switch"}]),F=L({component:[a()],path:[a()],"meta.title":[a()]}),{formRegister:R,formMethods:z}=U(),{setValues:p,getFormData:m,getElFormExpose:A,setSchema:u}=z,T=()=>c(this,null,function*(){const l=yield A();if(yield l==null?void 0:l.validate().catch(n=>{}))return yield m()}),b=V("");X(()=>w.currentRow,l=>{if(!l)return;const e=J(l);b.value=e.type===1?e.component:"",e.parentId===0?u([{field:"component",path:"componentProps.disabled",value:!0}]):u([{field:"component",path:"componentProps.disabled",value:!1}]),e.type===1?u([{field:"component",path:"componentProps.disabled",value:!1}]):u([{field:"component",path:"componentProps.disabled",value:!0}]),p(e)},{deep:!0,immediate:!0}),s({submit:T});const B=l=>c(this,null,function*(){const e=yield m();p({permissionList:[...(e==null?void 0:e.permissionList)||[],l]})});return(l,e)=>(Y(),Z(x,null,[o(h(M),{rules:F,onRegister:h(R),schema:d},null,8,["rules","onRegister","schema"]),o(j,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=n=>r.value=n),onConfirm:B},null,8,["modelValue"])],64))}});export{be as _};
