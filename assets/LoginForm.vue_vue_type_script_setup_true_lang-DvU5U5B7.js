var p=(k,y,i)=>new Promise((b,n)=>{var a=s=>{try{d(i.next(s))}catch(c){n(c)}},t=s=>{try{d(i.throw(s))}catch(c){n(c)}},d=s=>s.done?b(s.value):Promise.resolve(s.value).then(a,t);d((i=i.apply(k,y)).next())});import{F as U}from"./Form-BeN-d8Cw.js";import{u as j,b as K,c as T,l as O,d as W,e as $}from"./index-CShChEM-.js";/* empty css                    *//* empty css                */import{u as G}from"./useForm-zUnpEO4s.js";import{y as H,az as J,W as Q,r as F,o as X,w as Y,z as Z,K as ee,u as f,O as o,a4 as g,I as _}from"./vue-chunks-DjkM_pWB.js";import{u as oe}from"./useValidator-Nt61Jv1p.js";import{I as h}from"./Icon-CYGZSI4f.js";import{_ as z}from"./Button.vue_vue_type_script_setup_true_lang-CzUbuLFF.js";import{y as te,r as se}from"./element-plus-ByljZuZM.js";const w=30,R="#999",v="var(--el-color-primary)",ge=H({__name:"LoginForm",emits:["to-register"],setup(k,{emit:y}){const{required:i}=oe(),b=y,n=j(),a=K(),t=T(),{currentRoute:d,addRoute:s,push:c}=J(),A={username:[i()],password:[i()]},B=Q([{field:"title",colProps:{span:24},formItemProps:{slots:{default:()=>o("h2",{class:"text-2xl font-bold text-center w-[100%]"},[g("登录")])}}},{field:"username",label:"用户名",component:"Input",colProps:{span:24},componentProps:{placeholder:"admin or test"}},{field:"password",label:"密码",component:"InputPassword",colProps:{span:24},componentProps:{style:{width:"100%"},placeholder:"admin or test",onKeydown:e=>{e.key==="Enter"&&D()}}},{field:"tool",colProps:{span:24},formItemProps:{slots:{default:()=>o(_,null,[o("div",{class:"flex justify-between items-center w-[100%]"},[o(te,{modelValue:m.value,"onUpdate:modelValue":e=>m.value=e,label:"记住我",size:"small"},null),o(se,{type:"primary",underline:!1},{default:()=>[g("忘记密码")]})])])}}},{field:"login",colProps:{span:24},formItemProps:{slots:{default:()=>o(_,null,[o("div",{class:"w-[100%]"},[o(z,{loading:I.value,type:"primary",class:"w-[100%]",onClick:D},{default:()=>[g("登录")]})]),o("div",{class:"w-[100%] mt-15px"},[o(z,{class:"w-[100%]",onClick:N},{default:()=>[g("注册")]})])])}}},{field:"other",component:"Divider",label:"其它登录方式",componentProps:{contentPosition:"center"}},{field:"otherIcon",colProps:{span:24},formItemProps:{slots:{default:()=>o(_,null,[o("div",{class:"flex justify-between w-[100%]"},[o(h,{icon:"ant-design:github-filled",size:w,class:"cursor-pointer ant-icon",color:R,hoverColor:v},null),o(h,{icon:"ant-design:wechat-filled",size:w,class:"cursor-pointer ant-icon",color:R,hoverColor:v},null),o(h,{icon:"ant-design:alipay-circle-filled",size:w,color:R,hoverColor:v,class:"cursor-pointer ant-icon"},null),o(h,{icon:"ant-design:weibo-circle-filled",size:w,color:R,hoverColor:v,class:"cursor-pointer ant-icon"},null)])])}}}]),m=F(a.getRememberMe),E=()=>{const e=a.getLoginInfo;if(e){const{username:r,password:l}=e;M({username:r,password:l})}};X(()=>{E()});const{formRegister:S,formMethods:L}=G(),{getFormData:x,getElFormExpose:V,setValues:M}=L,I=F(!1),P=F("");Y(()=>d.value,e=>{var r;P.value=(r=e==null?void 0:e.query)==null?void 0:r.redirect},{immediate:!0});const D=()=>p(this,null,function*(){const e=yield V();yield e==null?void 0:e.validate(r=>p(this,null,function*(){if(r){I.value=!0;const l=yield x();try{const u=yield O(l);u&&(f(m)?a.setLoginInfo({username:l.username,password:l.password}):a.setLoginInfo(void 0),a.setRememberMe(f(m)),a.setUserInfo(u.data),n.getDynamicRouter?q():(yield t.generateRoutes("static").catch(()=>{}),t.getAddRouters.forEach(C=>{s(C)}),t.setIsAddRouters(!0),c({path:P.value||t.addRouters[0].path})))}finally{I.value=!1}}}))}),q=()=>p(this,null,function*(){const r={roleName:(yield x()).username},l=n.getDynamicRouter&&n.getServerDynamicRouter?yield W(r):yield $(r);if(l){const u=l.data||[];a.setRoleRouters(u),n.getDynamicRouter&&n.getServerDynamicRouter?yield t.generateRoutes("server",u).catch(()=>{}):yield t.generateRoutes("frontEnd",u).catch(()=>{}),t.getAddRouters.forEach(C=>{s(C)}),t.setIsAddRouters(!0),c({path:P.value||t.addRouters[0].path})}}),N=()=>{b("to-register")};return(e,r)=>(Z(),ee(f(U),{schema:B,rules:A,"label-position":"top","hide-required-asterisk":"",size:"large",class:"dark:border-1 dark:border-[var(--el-border-color)] dark:border-solid",onRegister:f(S)},null,8,["schema","onRegister"]))}});export{ge as _};
