var ae=Object.defineProperty,re=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var H=(d,o,l)=>o in d?ae(d,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):d[o]=l,E=(d,o)=>{for(var l in o||(o={}))oe.call(o,l)&&H(d,l,o[l]);if(q)for(var l of q(o))ie.call(o,l)&&H(d,l,o[l]);return d},M=(d,o)=>re(d,le(o));var m=(d,o,l)=>new Promise((S,w)=>{var A=n=>{try{p(l.next(n))}catch(c){w(c)}},N=n=>{try{p(l.throw(n))}catch(c){w(c)}},p=n=>n.done?S(n.value):Promise.resolve(n.value).then(A,N);p((l=l.apply(d,o)).next())});import{_ as O}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CAJscVvw.js";import{_ as ne}from"./Table.vue_vue_type_script_lang-BJvtTqWD.js";import"./index-CShChEM-.js";/* empty css                        *//* empty css                    *//* empty css                  *//* empty css                *//* empty css                   */import{g as Q,b as se,c as de,e as ue}from"./index-DTlGuLUK.js";import{u as me}from"./useTable-B8JiDRl-.js";import{_ as pe}from"./Search.vue_vue_type_script_setup_true_lang-Cw4W-5Vx.js";import{_ as ce}from"./Write.vue_vue_type_script_setup_true_lang-DThNDwTF.js";import{_ as fe}from"./Detail.vue_vue_type_script_setup_true_lang-Camch9C2.js";import{_ as ve}from"./Dialog.vue_vue_type_style_index_0_lang-COoO_oLO.js";import{g as ge}from"./index-CszAZ0O-.js";import{u as he}from"./useCrudSchemas-Cog1rf3Y.js";import{_ as f}from"./Button.vue_vue_type_script_setup_true_lang-CzUbuLFF.js";import{A as ye,q as we,ak as be}from"./element-plus-ByljZuZM.js";import{y as _e,W as ke,O as i,a4 as v,I as xe,r as s,w as Ce,u as t,z as x,A as Se,L as u,D as C,Q as Ae,l as W,K as L,H as U,n as Ne}from"./vue-chunks-DjkM_pWB.js";import"./Icon-CYGZSI4f.js";/* empty css                *//* empty css               *//* empty css                      *//* empty css                  *//* empty css                        */import"./el-radio-button-CBHeQXLS.js";/* empty css                         *//* empty css                  */import"./index-DB0iy_uu.js";import"./Form-BeN-d8Cw.js";/* empty css                     *//* empty css               *//* empty css                        *//* empty css                    */import"./InputPassword-Ct7cxC8e.js";import"./style.css_vue_type_style_index_0_src_true_lang-kJ8-wxjb.js";import"./wang-editor-Osncebl8.js";import"./JsonEditor.vue_vue_type_script_setup_true_lang-DAQ6MuDU.js";import"./IconPicker-Bz6sqlJj.js";import"./useForm-zUnpEO4s.js";import"./useIcon-DWxSlYSa.js";import"./useValidator-Nt61Jv1p.js";import"./Descriptions-CjU8IktX.js";import"./tree-V8lrdewf.js";const De={class:"flex w-100% h-100%"},Ve={class:"flex justify-center items-center"},Re=["title"],Te={class:"mb-10px"},Ct=_e({__name:"User",setup(d){const{tableRegister:o,tableState:l,tableMethods:S}=me({fetchDataApi:()=>m(this,null,function*(){const{pageSize:a,currentPage:e}=l,r=yield se(E({id:t(h),pageIndex:t(e),pageSize:t(a)},t(z)));return{list:r.data.list||[],total:r.data.total||0}}),fetchDelApi:()=>m(this,null,function*(){return!!(yield de(t(T)))})}),{total:w,loading:A,dataList:N,pageSize:p,currentPage:n}=l,{getList:c,getElTableExpose:G,delList:J}=S,X=ke([{field:"selection",search:{hidden:!0},form:{hidden:!0},detail:{hidden:!0},table:{type:"selection"}},{field:"index",label:"序号",form:{hidden:!0},search:{hidden:!0},detail:{hidden:!0},table:{type:"index"}},{field:"username",label:"用户名"},{field:"account",label:"账号"},{field:"department.id",label:"所属部门",detail:{hidden:!0},search:{hidden:!0},form:{component:"TreeSelect",componentProps:{nodeKey:"id",props:{label:"departmentName"}},optionApi:()=>m(this,null,function*(){return(yield Q()).data.list})},table:{hidden:!0}},{field:"role",label:"角色",search:{hidden:!0},form:{component:"Select",value:[],componentProps:{multiple:!0,collapseTags:!0,maxCollapseTags:1},optionApi:()=>m(this,null,function*(){var e,r;return(r=(e=(yield ge()).data)==null?void 0:e.list)==null?void 0:r.map(j=>({label:j.roleName,value:j.id}))})}},{field:"email",label:"邮箱",form:{component:"Input"},search:{hidden:!0}},{field:"createTime",label:"创建时间",form:{component:"Input"},search:{hidden:!0}},{field:"action",label:"操作",form:{hidden:!0},detail:{hidden:!0},search:{hidden:!0},table:{width:240,slots:{default:a=>{const e=a.row;return i(xe,null,[i(f,{type:"primary",onClick:()=>K(e,"edit")},{default:()=>[v("编辑")]}),i(f,{type:"success",onClick:()=>K(e,"detail")},{default:()=>[v("详情")]}),i(f,{type:"danger",onClick:()=>P(e)},{default:()=>[v("删除")]})])}}}}]),{allSchemas:b}=he(X),z=s({}),B=a=>{n.value=1,z.value=a,c()},_=s(),h=s(""),I=s([]);m(this,null,function*(){var e,r;const a=yield Q();I.value=a.data.list,h.value=a.data.list[0]&&((e=a.data.list[0])==null?void 0:e.children)&&a.data.list[0].children[0].id||"",yield Ne(),(r=t(_))==null||r.setCurrentKey(h.value)});const D=s("");Ce(()=>D.value,a=>{t(_).filter(a)});const Y=a=>{h.value=a.id,n.value=1,c()},Z=(a,e)=>a?e.departmentName.includes(a):!0,g=s(!1),V=s(""),k=s(),y=s(""),ee=()=>{V.value="新增",k.value=void 0,g.value=!0,y.value=""},R=s(!1),T=s([]),P=a=>m(this,null,function*(){const e=yield G();T.value=a?[a.id]:(e==null?void 0:e.getSelectionRows().map(r=>r.id))||[],R.value=!0,yield J(t(T).length).finally(()=>{R.value=!1})}),K=(a,e)=>{var r;V.value=e==="edit"?"编辑":"详情",y.value=e,k.value=M(E({},a),{department:((r=t(_))==null?void 0:r.getCurrentNode())||{}}),g.value=!0},F=s(),$=s(!1),te=()=>m(this,null,function*(){const a=t(F),e=yield a==null?void 0:a.submit();if(e){$.value=!0;try{(yield ue(e))&&(n.value=1,c())}catch(r){}finally{$.value=!1,g.value=!1}}});return(a,e)=>(x(),Se("div",De,[i(t(O),{class:"w-250px"},{default:u(()=>[C("div",Ve,[e[6]||(e[6]=C("div",{class:"flex-1"},"部门列表",-1)),i(t(ye),{modelValue:D.value,"onUpdate:modelValue":e[0]||(e[0]=r=>D.value=r),class:"flex-[2]",placeholder:"搜索部门",clearable:""},null,8,["modelValue"])]),i(t(we)),i(t(be),{ref_key:"treeEl",ref:_,data:I.value,"default-expand-all":"","expand-on-click-node":!1,"node-key":"id","current-node-key":h.value,props:{label:"departmentName"},"filter-node-method":Z,onCurrentChange:Y},{default:u(({data:r})=>[C("div",{title:r.departmentName,class:"whitespace-nowrap overflow-ellipsis overflow-hidden"},Ae(r.departmentName),9,Re)]),_:1},8,["data","current-node-key","filter-node-method"])]),_:1}),i(t(O),{class:"flex-[3] ml-20px"},{default:u(()=>[i(t(pe),{schema:t(b).searchSchema,onReset:B,onSearch:B},null,8,["schema"]),C("div",Te,[i(t(f),{type:"primary",onClick:ee},{default:u(()=>e[7]||(e[7]=[v("新增")])),_:1}),i(t(f),{loading:R.value,type:"danger",onClick:e[1]||(e[1]=r=>P())},{default:u(()=>e[8]||(e[8]=[v(" 删除 ")])),_:1},8,["loading"])]),i(t(ne),{"current-page":t(n),"onUpdate:currentPage":e[2]||(e[2]=r=>W(n)?n.value=r:null),"page-size":t(p),"onUpdate:pageSize":e[3]||(e[3]=r=>W(p)?p.value=r:null),columns:t(b).tableColumns,data:t(N),loading:t(A),onRegister:t(o),pagination:{total:t(w)}},null,8,["current-page","page-size","columns","data","loading","onRegister","pagination"])]),_:1}),i(t(ve),{modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=r=>g.value=r),title:V.value},{footer:u(()=>[y.value!=="detail"?(x(),L(t(f),{key:0,type:"primary",loading:$.value,onClick:te},{default:u(()=>e[9]||(e[9]=[v(" 保存 ")])),_:1},8,["loading"])):U("",!0),i(t(f),{onClick:e[4]||(e[4]=r=>g.value=!1)},{default:u(()=>e[10]||(e[10]=[v("关闭")])),_:1})]),default:u(()=>[y.value!=="detail"?(x(),L(ce,{key:0,ref_key:"writeRef",ref:F,"form-schema":t(b).formSchema,"current-row":k.value},null,8,["form-schema","current-row"])):U("",!0),y.value==="detail"?(x(),L(fe,{key:1,"detail-schema":t(b).detailSchema,"current-row":k.value},null,8,["detail-schema","current-row"])):U("",!0)]),_:1},8,["modelValue","title"])]))}});export{Ct as default};
