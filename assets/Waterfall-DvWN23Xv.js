var P=Object.defineProperty,Q=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var N=(e,t,a)=>t in e?P(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,B=(e,t)=>{for(var a in t||(t={}))Y.call(t,a)&&N(e,a,t[a]);if(z)for(var a of z(t))G.call(t,a)&&N(e,a,t[a]);return e},E=(e,t)=>Q(e,X(t));var O=(e,t,a)=>new Promise((l,x)=>{var f=r=>{try{h(a.next(r))}catch(i){x(i)}},d=r=>{try{h(a.throw(r))}catch(i){x(i)}},h=r=>r.done?l(r.value):Promise.resolve(r.value).then(f,d);h((a=a.apply(e,t)).next())});import{p as u,M as W,t as J}from"./index-B_wof8e7.js";import{L as K,I as U,M as Z}from"./element-plus-0HRIQ2yl.js";import{q as I,r as v,w as _,o as ee,u as o,t as m,v as p,V as k,Q as R,a8 as S,M as A,x as C,X as D,Y as te,n as H,T as ae,S as le,P as se}from"./vue-chunks-DOWhatC1.js";import{_ as oe}from"./ContentWrap.vue_vue_type_script_setup_true_lang-C0J0ZRE2.js";import"./Icon-CLCWynVC.js";/* empty css                *//* empty css                  */const ne=["src"],re=["src"],ie=I({__name:"Waterfall",props:{data:u.arrayOf(u.any),reset:u.bool.def(!0),width:u.number.def(200),gap:u.number.def(20),props:u.objectOf(u.string).def({src:"src",height:"height"}),cols:u.number.def(void 0),loadingText:u.string.def("加载中..."),loading:u.bool.def(!1),end:u.bool.def(!1),endText:u.string.def("没有更多了"),autoCenter:u.bool.def(!0),layout:u.oneOf(["javascript","flex"]).def("flex")},emits:["loadMore"],setup(e,{emit:t}){const a=t,l=e,x=v(),f=v([]),d=v(0),h=v(0),r=v(),i=v(0),y=v([]),q=()=>O(this,null,function*(){var j;y.value=[];const{props:g,width:w,gap:s}=l,n=l.data;yield H();const $=o(x);if(!$)return;i.value=(j=l.cols)!=null?j:Math.floor($.clientWidth/(w+s));const b=n.length;for(let c=0;c<b;c++)if(c<o(i))f.value[c]=n[c][g.height],y.value.push(E(B({},n[c]),{top:0,left:c*(w+s)}));else{let M=f.value[0],L=0;for(let T=1;T<o(i);T++)o(f)[T]<M&&(M=o(f)[T],L=T);f.value[L]+=n[c][g.height]+s,y.value.push(E(B({},n[c]),{top:M+s,left:L*(w+s)}))}d.value=Math.max(...o(f)),h.value=o(i)*(w+s)-s}),F=()=>O(this,null,function*(){var j;const{width:g,gap:w}=l,s=l.data;yield H();const n=o(x);if(!n)return;i.value=(j=l.cols)!=null?j:Math.floor(n.clientWidth/(g+w));const $=s.length,b=new Array(o(i)).fill([]);for(let c=0;c<$;c++){const M=c%o(i);b[M]=[...b[M],s[c]]}y.value=b}),V=()=>{const{layout:g}=l;g==="javascript"?q():g==="flex"&&F()};return _(()=>[l.data,l.cols],()=>{V()},{immediate:!0}),ee(()=>{o(l.reset)&&K(window,"resize",U(V,300)),Z(o(r),([{isIntersecting:g}])=>{g&&!l.loading&&!l.end&&a("loadMore")},{threshold:.1})}),(g,w)=>(m(),p("div",{class:A(["waterfall","flex","items-center",{"justify-center":e.autoCenter}]),ref_key:"wrapEl",ref:x,style:k({height:`${e.layout==="javascript"?d.value+40:"auto"}px`})},[e.layout==="javascript"?(m(),p("div",{key:0,class:"relative",style:k({width:`${h.value}px`,height:`${d.value+40}px`})},[(m(!0),p(R,null,S(y.value,(s,n)=>(m(),p("div",{class:A([`waterfall-item__${n}`,{absolute:e.layout==="javascript"}]),key:`water-${n}`,style:k({width:`${e.width}px`,height:`${s[e.props.height]}px`,top:`${s.top}px`,left:`${s.left}px`})},[C("img",{src:s[e.props.src],class:"w-full h-full block",alt:"",srcset:""},null,8,ne)],6))),128)),C("div",{ref_key:"loadMore",ref:r,class:"h-40px flex justify-center absolute w-full",style:k({top:`${d.value+e.gap}px`})},D(e.end?e.endText:e.loadingText),5)],4)):e.layout==="flex"?(m(),p("div",{key:1,class:"relative flex pb-40px",style:k({width:e.cols?"100%":"auto"})},[(m(!0),p(R,null,S(y.value,(s,n)=>(m(),p("div",{key:`waterWrap-${n}`,class:"flex-1",style:k({marginRight:n===y.value.length-1?"0":`${e.gap}px`})},[(m(!0),p(R,null,S(s,($,b)=>(m(),p("div",{key:`waterWrap-${n}-${b}`,style:k({marginBottom:`${e.gap}px`,width:e.cols?"100%":`${e.width}px`,height:e.cols?"auto":`${$[e.props.height]}px`})},[C("img",{src:$[e.props.src],class:"w-full h-full block",alt:"",srcset:""},null,8,re)],4))),128))],4))),128)),C("div",{ref_key:"loadMore",ref:r,class:"h-40px flex justify-center absolute w-full items-center",style:{bottom:0}},D(e.end?e.endText:e.loadingText),513)],4)):te("",!0)],6))}}),xe=I({__name:"Waterfall",setup(e){const t=v([]),a=()=>{const d=[];for(let h=0;h<20;h++){const r=W.Random.integer(100,500),i=W.Random.integer(100,500);d.push(W.mock({width:i,height:r,id:J(),image_uri:W.Random.image(`${i}x${r}`).replace("http://","https://")}))}t.value=[...o(t),...d],o(t).length>=60&&(x.value=!0)};a();const l=v(!1),x=v(!1),f=()=>{l.value=!0,setTimeout(()=>{a(),l.value=!1},1e3)};return(d,h)=>(m(),ae(o(oe),{title:"瀑布流"},{default:le(()=>[se(o(ie),{data:t.value,loading:l.value,end:x.value,props:{src:"image_uri",height:"height"},onLoadMore:f},null,8,["data","loading","end"])]),_:1}))}});export{xe as default};
