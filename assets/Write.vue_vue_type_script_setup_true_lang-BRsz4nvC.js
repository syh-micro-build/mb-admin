var s=(b,w,l)=>new Promise((v,d)=>{var c=n=>{try{p(l.next(n))}catch(r){d(r)}},y=n=>{try{p(l.throw(n))}catch(r){d(r)}},p=n=>n.done?v(n.value):Promise.resolve(n.value).then(c,y);p((l=l.apply(b,w)).next())});import{F as x}from"./Form-Dv9ZnNbH.js";import{u as V}from"./useForm-DyGwfec9.js";import{u as L}from"./useValidator-Nt61Jv1p.js";import{g as R}from"./index-C0NZ3Yzn.js";import"./index-BJvxPDDc.js";/* empty css               */import{_ as D}from"./AddButtonPermission.vue_vue_type_script_setup_true_lang-BfohUDOx.js";import{_ as F}from"./Button.vue_vue_type_script_setup_true_lang-B0Hs-uJB.js";import{C as T,d as B}from"./element-plus-DmczhoYX.js";import{q as E,r as g,K as P,u as h,P as u,W as N,Q as S,w as A,t as M,v as O}from"./vue-chunks-DOWhatC1.js";const X=E({__name:"Write",props:{currentRow:{type:Object,default:()=>null}},setup(b,{expose:w}){const{required:l}=L(),v=b,d=o=>s(this,null,function*(){var t;const e=yield m();a({permissionList:(t=e==null?void 0:e.permissionList)==null?void 0:t.filter(k=>k.value!==o.value)})}),c=g(!1),y=P([{field:"type",label:"菜单类型",component:"RadioButton",value:0,colProps:{span:24},componentProps:{options:[{label:"目录",value:0},{label:"菜单",value:1}],on:{change:o=>s(this,null,function*(){const e=yield m();o===1?(i([{field:"component",path:"componentProps.disabled",value:!1}]),a({component:h(f)})):(i([{field:"component",path:"componentProps.disabled",value:!0}]),e.parentId===void 0?a({component:"#"}):a({component:"##"}))})}}},{field:"parentId",label:"父级菜单",component:"TreeSelect",componentProps:{nodeKey:"id",props:{label:"title",value:"id",children:"children"},highlightCurrent:!0,expandOnClickNode:!1,checkStrictly:!0,checkOnClickNode:!0,clearable:!0,on:{change:o=>s(this,null,function*(){var t;const e=yield m();o&&e.type===0?a({component:"##"}):!o&&e.type===0?a({component:"#"}):e.type===1&&a({component:(t=h(f))!=null?t:""})})}},optionApi:()=>s(this,null,function*(){return(yield R()).data.list||[]})},{field:"meta.title",label:"菜单名称",component:"Input"},{field:"component",label:"组件",component:"Input",value:"#",componentProps:{disabled:!0,placeholder:"#为顶级目录，##为子目录",on:{change:o=>{f.value=o}}}},{field:"name",label:"组件名称",component:"Input"},{field:"meta.icon",label:"图标",component:"Input"},{field:"path",label:"路径",component:"Input"},{field:"meta.activeMenu",label:"高亮菜单",component:"Input"},{field:"status",label:"状态",component:"Select",componentProps:{options:[{label:"禁用",value:0},{label:"启用",value:1}]}},{field:"permissionList",label:"按钮权限",component:"CheckboxGroup",colProps:{span:24},formItemProps:{slots:{default:o=>{var e;return u(S,null,[(e=o==null?void 0:o.permissionList)==null?void 0:e.map(t=>u(T,{class:"mr-1",key:t.value,closable:!0,onClose:()=>d(t)},{default:()=>[t.label]})),u(F,{type:"primary",size:"small",onClick:()=>c.value=!0},{default:()=>[N("添加权限")]})])}}}},{field:"meta.hidden",label:"是否隐藏",component:"Switch"},{field:"meta.alwaysShow",label:"是否一直显示",component:"Switch"},{field:"meta.noCache",label:"是否清除缓存",component:"Switch"},{field:"meta.breadcrumb",label:"是否显示面包屑",component:"Switch"},{field:"meta.affix",label:"是否固定在标签页",component:"Switch"},{field:"meta.noTagsView",label:"是否隐藏标签页",component:"Switch"},{field:"meta.canTo",label:"是否可跳转",component:"Switch"}]),p=P({component:[l()],path:[l()],"meta.title":[l()]}),{formRegister:n,formMethods:r}=V(),{setValues:a,getFormData:m,getElFormExpose:C,setSchema:i}=r,_=()=>s(this,null,function*(){const o=yield C();if(yield o==null?void 0:o.validate().catch(t=>{}))return yield m()}),f=g("");A(()=>v.currentRow,o=>{if(!o)return;const e=B(o);f.value=e.type===1?e.component:"",e.parentId===0?i([{field:"component",path:"componentProps.disabled",value:!0}]):i([{field:"component",path:"componentProps.disabled",value:!1}]),e.type===1?i([{field:"component",path:"componentProps.disabled",value:!1}]):i([{field:"component",path:"componentProps.disabled",value:!0}]),a(e)},{deep:!0,immediate:!0}),w({submit:_});const I=o=>s(this,null,function*(){const e=yield m();a({permissionList:[...(e==null?void 0:e.permissionList)||[],o]})});return(o,e)=>(M(),O(S,null,[u(h(x),{rules:p,onRegister:h(n),schema:y},null,8,["rules","onRegister","schema"]),u(D,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=t=>c.value=t),onConfirm:I},null,8,["modelValue"])],64))}});export{X as _};
