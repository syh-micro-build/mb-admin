var ae=Object.defineProperty,re=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var M=(d,o,l)=>o in d?ae(d,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):d[o]=l,E=(d,o)=>{for(var l in o||(o={}))oe.call(o,l)&&M(d,l,o[l]);if(j)for(var l of j(o))ie.call(o,l)&&M(d,l,o[l]);return d},Q=(d,o)=>re(d,le(o));var c=(d,o,l)=>new Promise((S,y)=>{var N=n=>{try{m(l.next(n))}catch(p){y(p)}},A=n=>{try{m(l.throw(n))}catch(p){y(p)}},m=n=>n.done?S(n.value):Promise.resolve(n.value).then(N,A);m((l=l.apply(d,o)).next())});import{_ as W}from"./ContentWrap.vue_vue_type_script_setup_true_lang-DmM_36pX.js";import{_ as ne}from"./Table.vue_vue_type_script_lang-DYtDFcZp.js";import"./index-DHjfWeid.js";/* empty css                    *//* empty css                  *//* empty css                *//* empty css                   */import{g as X,b as se,c as de,e as ue}from"./index-Bnir2VPd.js";import{u as ce}from"./useTable-CjgLHHLS.js";import{_ as me}from"./Search.vue_vue_type_script_setup_true_lang-CS_9Gpkt.js";import{_ as pe}from"./Write.vue_vue_type_script_setup_true_lang-DT2tZvA3.js";import{_ as fe}from"./Detail.vue_vue_type_script_setup_true_lang-BIK1T9yn.js";import{_ as ve}from"./Dialog.vue_vue_type_style_index_0_lang-BZKim-TA.js";import{g as he}from"./index-D1GOVm93.js";import{u as ge}from"./useCrudSchemas-B5FzcJ46.js";import{_ as f}from"./Button.vue_vue_type_script_setup_true_lang-B3PHPbFv.js";import{A as _e,q as ye,ak as we}from"./element-plus-0HRIQ2yl.js";import{q as be,K as ke,P as i,W as v,Q as xe,r as s,w as Ce,u as t,t as x,v as Se,S as u,x as C,X as Ne,i as Y,T as P,Y as U,n as Ae}from"./vue-chunks-DOWhatC1.js";import"./Icon-CDGUbBOZ.js";/* empty css                *//* empty css               *//* empty css                      *//* empty css                  *//* empty css                        */import"./el-radio-button-DAkZr4t4.js";/* empty css                         *//* empty css                  */import"./index-DQ1HvDrY.js";import"./Form-CcadvY4i.js";/* empty css                     *//* empty css               *//* empty css                        *//* empty css                    */import"./InputPassword-BDXcT1Ff.js";import"./style.css_vue_type_style_index_0_src_true_lang-Dm-2_FVr.js";import"./wang-editor-DjPKVaXS.js";import"./JsonEditor.vue_vue_type_script_setup_true_lang-D9lDC4Kz.js";import"./IconPicker-CXkom4sM.js";import"./useForm-DPv4piFD.js";import"./useIcon-baQX6xF1.js";import"./useValidator-Nt61Jv1p.js";import"./Descriptions-BkU9Fkp-.js";import"./tree-Dgaev6Pi.js";const Te={class:"flex w-100% h-100%"},Ve={class:"flex justify-center items-center"},De=C("div",{class:"flex-1"},"部门列表",-1),Re=["title"],$e={class:"mb-10px"},Ct=be({__name:"User",setup(d){const{tableRegister:o,tableState:l,tableMethods:S}=ce({fetchDataApi:()=>c(this,null,function*(){const{pageSize:a,currentPage:e}=l,r=yield se(E({id:t(g),pageIndex:t(e),pageSize:t(a)},t(B)));return{list:r.data.list||[],total:r.data.total||0}}),fetchDelApi:()=>c(this,null,function*(){return!!(yield de(t(R)))})}),{total:y,loading:N,dataList:A,pageSize:m,currentPage:n}=l,{getList:p,getElTableExpose:G,delList:H}=S,J=ke([{field:"selection",search:{hidden:!0},form:{hidden:!0},detail:{hidden:!0},table:{type:"selection"}},{field:"index",label:"序号",form:{hidden:!0},search:{hidden:!0},detail:{hidden:!0},table:{type:"index"}},{field:"username",label:"用户名"},{field:"account",label:"账号"},{field:"department.id",label:"所属部门",detail:{hidden:!0},search:{hidden:!0},form:{component:"TreeSelect",componentProps:{nodeKey:"id",props:{label:"departmentName"}},optionApi:()=>c(this,null,function*(){return(yield X()).data.list})},table:{hidden:!0}},{field:"role",label:"角色",search:{hidden:!0},form:{component:"Select",value:[],componentProps:{multiple:!0,collapseTags:!0,maxCollapseTags:1},optionApi:()=>c(this,null,function*(){var e,r;return(r=(e=(yield he()).data)==null?void 0:e.list)==null?void 0:r.map(q=>({label:q.roleName,value:q.id}))})}},{field:"email",label:"邮箱",form:{component:"Input"},search:{hidden:!0}},{field:"createTime",label:"创建时间",form:{component:"Input"},search:{hidden:!0}},{field:"action",label:"操作",form:{hidden:!0},detail:{hidden:!0},search:{hidden:!0},table:{width:240,slots:{default:a=>{const e=a.row;return i(xe,null,[i(f,{type:"primary",onClick:()=>K(e,"edit")},{default:()=>[v("编辑")]}),i(f,{type:"success",onClick:()=>K(e,"detail")},{default:()=>[v("详情")]}),i(f,{type:"danger",onClick:()=>I(e)},{default:()=>[v("删除")]})])}}}}]),{allSchemas:w}=ge(J),B=s({}),L=a=>{n.value=1,B.value=a,p()},b=s(),g=s(""),z=s([]);c(this,null,function*(){var e,r;const a=yield X();z.value=a.data.list,g.value=a.data.list[0]&&((e=a.data.list[0])==null?void 0:e.children)&&a.data.list[0].children[0].id||"",yield Ae(),(r=t(b))==null||r.setCurrentKey(g.value)});const T=s("");Ce(()=>T.value,a=>{t(b).filter(a)});const O=a=>{g.value=a.id,n.value=1,p()},Z=(a,e)=>a?e.departmentName.includes(a):!0,h=s(!1),V=s(""),k=s(),_=s(""),ee=()=>{V.value="新增",k.value=void 0,h.value=!0,_.value=""},D=s(!1),R=s([]),I=a=>c(this,null,function*(){const e=yield G();R.value=a?[a.id]:(e==null?void 0:e.getSelectionRows().map(r=>r.id))||[],D.value=!0,yield H(t(R).length).finally(()=>{D.value=!1})}),K=(a,e)=>{var r;V.value=e==="edit"?"编辑":"详情",_.value=e,k.value=Q(E({},a),{department:((r=t(b))==null?void 0:r.getCurrentNode())||{}}),h.value=!0},F=s(),$=s(!1),te=()=>c(this,null,function*(){const a=t(F),e=yield a==null?void 0:a.submit();if(e){$.value=!0;try{(yield ue(e))&&(n.value=1,p())}catch(r){}finally{$.value=!1,h.value=!1}}});return(a,e)=>(x(),Se("div",Te,[i(t(W),{class:"w-250px"},{default:u(()=>[C("div",Ve,[De,i(t(_e),{modelValue:T.value,"onUpdate:modelValue":e[0]||(e[0]=r=>T.value=r),class:"flex-[2]",placeholder:"搜索部门",clearable:""},null,8,["modelValue"])]),i(t(ye)),i(t(we),{ref_key:"treeEl",ref:b,data:z.value,"default-expand-all":"","expand-on-click-node":!1,"node-key":"id","current-node-key":g.value,props:{label:"departmentName"},"filter-node-method":Z,onCurrentChange:O},{default:u(({data:r})=>[C("div",{title:r.departmentName,class:"whitespace-nowrap overflow-ellipsis overflow-hidden"},Ne(r.departmentName),9,Re)]),_:1},8,["data","current-node-key","filter-node-method"])]),_:1}),i(t(W),{class:"flex-[3] ml-20px"},{default:u(()=>[i(t(me),{schema:t(w).searchSchema,onReset:L,onSearch:L},null,8,["schema"]),C("div",$e,[i(t(f),{type:"primary",onClick:ee},{default:u(()=>[v("新增")]),_:1}),i(t(f),{loading:D.value,type:"danger",onClick:e[1]||(e[1]=r=>I())},{default:u(()=>[v(" 删除 ")]),_:1},8,["loading"])]),i(t(ne),{"current-page":t(n),"onUpdate:currentPage":e[2]||(e[2]=r=>Y(n)?n.value=r:null),"page-size":t(m),"onUpdate:pageSize":e[3]||(e[3]=r=>Y(m)?m.value=r:null),columns:t(w).tableColumns,data:t(A),loading:t(N),onRegister:t(o),pagination:{total:t(y)}},null,8,["current-page","page-size","columns","data","loading","onRegister","pagination"])]),_:1}),i(t(ve),{modelValue:h.value,"onUpdate:modelValue":e[5]||(e[5]=r=>h.value=r),title:V.value},{footer:u(()=>[_.value!=="detail"?(x(),P(t(f),{key:0,type:"primary",loading:$.value,onClick:te},{default:u(()=>[v(" 保存 ")]),_:1},8,["loading"])):U("",!0),i(t(f),{onClick:e[4]||(e[4]=r=>h.value=!1)},{default:u(()=>[v("关闭")]),_:1})]),default:u(()=>[_.value!=="detail"?(x(),P(pe,{key:0,ref_key:"writeRef",ref:F,"form-schema":t(w).formSchema,"current-row":k.value},null,8,["form-schema","current-row"])):U("",!0),_.value==="detail"?(x(),P(fe,{key:1,"detail-schema":t(w).detailSchema,"current-row":k.value},null,8,["detail-schema","current-row"])):U("",!0)]),_:1},8,["modelValue","title"])]))}});export{Ct as default};
