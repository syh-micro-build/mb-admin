var V=Object.defineProperty;var v=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable;var y=(o,s,e)=>s in o?V(o,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[s]=e,R=(o,s)=>{for(var e in s||(s={}))I.call(s,e)&&y(o,e,s[e]);if(v)for(var e of v(s))M.call(s,e)&&y(o,e,s[e]);return o};var w=(o,s,e)=>new Promise((f,d)=>{var b=i=>{try{h(e.next(i))}catch(g){d(g)}},c=i=>{try{h(e.throw(i))}catch(g){d(g)}},h=i=>i.done?f(i.value):Promise.resolve(i.value).then(b,c);h((e=e.apply(o,s)).next())});import{F as N}from"./Form-CZOzD3IG.js";import{u as K}from"./useForm-Dg0OwJE9.js";import{u as P}from"./useValidator-Nt61Jv1p.js";import{q}from"./index-DGmNIDfv.js";/* empty css                *//* empty css                    */import"./el-radio-button-7PIAqI6r.js";import{g as B}from"./index-DQGUoTaF.js";import{e as _,f as O}from"./tree-V8lrdewf.js";import{al as S,T as W,D as j}from"./element-plus-BuBGixiZ.js";import{y as z,r as x,O as u,u as l,I as A,W as G,w as U,z as H,K as J,n as Q}from"./vue-chunks-CaTGQ7j2.js";const ce=z({__name:"Write",props:{currentRow:{type:Object,default:()=>null}},setup(o,{expose:s}){const{required:e}=P(),f=o,d=x(),b=x([{field:"roleName",label:"角色名称",component:"Input"},{field:"status",label:"状态",component:"Select",componentProps:{options:[{label:"禁用",value:0},{label:"启用",value:1}]}},{field:"menu",label:"菜单分配",colProps:{span:24},formItemProps:{slots:{default:()=>{var t;return u(A,null,[u("div",{class:"flex w-full"},[u("div",{class:"flex-1"},[u(S,{ref:d,"show-checkbox":!0,"node-key":"id","highlight-current":!0,"check-strictly":!0,"expand-on-click-node":!1,data:k.value,"onNode-click":h},{default:r=>u("span",null,[r.data.meta.title])})]),u("div",{class:"flex-1"},[l(c)&&((t=l(c))!=null&&t.permissionList)?u(W,{modelValue:l(c).meta.permission,"onUpdate:modelValue":r=>l(c).meta.permission=r},{default:()=>{var r;return[(r=l(c))==null?void 0:r.permissionList.map(n=>u(j,{label:n.value},{default:()=>[n.label]}))]}}):null])])])}}}}]),c=x(),h=t=>{c.value=t},i=G({roleName:[e()],role:[e()],status:[e()]}),{formRegister:g,formMethods:C}=K(),{setValues:D,getFormData:E,getElFormExpose:F}=C,k=x([]);w(this,null,function*(){var r;const t=yield B();if(t){if(k.value=t.data.list,!f.currentRow)return;yield Q();const n=[];_(f.currentRow.menu,a=>{var m;n.push({id:a.id,permission:((m=a.meta)==null?void 0:m.permission)||[]})}),_(k.value,a=>{const m=q(n,p=>p.id===a.id);if(m>-1){const p=R({},a.meta||{});p.permission=n[m].permission,a.meta=p}});for(const a of n)(r=l(d))==null||r.setChecked(a.id,!0,!1)}});const L=()=>w(this,null,function*(){var n;const t=yield F();if(yield t==null?void 0:t.validate().catch(a=>{})){const a=yield E(),m=((n=l(d))==null?void 0:n.getCheckedKeys())||[],p=O(l(k),T=>m.includes(T.id));return a.menu=p||[],a}});return U(()=>f.currentRow,t=>{t&&D(t)},{deep:!0,immediate:!0}),s({submit:L}),(t,r)=>(H(),J(l(N),{rules:i,onRegister:l(g),schema:b.value},null,8,["rules","onRegister","schema"]))}});export{ce as _};
