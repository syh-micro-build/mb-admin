var p=(x,y,i)=>new Promise((b,n)=>{var a=s=>{try{d(i.next(s))}catch(c){n(c)}},t=s=>{try{d(i.throw(s))}catch(c){n(c)}},d=s=>s.done?b(s.value):Promise.resolve(s.value).then(a,t);d((i=i.apply(x,y)).next())});import{F as U}from"./Form-Cq2JTCc3.js";import{u as j,b as T,c as J,l as O,d as $,e as G}from"./index-lp8iKSv1.js";/* empty css                    *//* empty css                */import{u as H}from"./useForm-DxmPpXWp.js";import{q as K,aA as Q,J as W,r as F,o as X,w as Y,t as Z,S as ee,u as f,O as e,V as g,P as _}from"./vue-chunks-CrLAACUV.js";import{u as oe}from"./useValidator-Nt61Jv1p.js";import{I as h}from"./Icon-Bfhd4Js4.js";import{_ as k}from"./Button.vue_vue_type_script_setup_true_lang-DKc4O2hz.js";import{y as te,r as se}from"./element-plus-Dmwbteg1.js";const w=30,R="#999",v="var(--el-color-primary)",ge=K({__name:"LoginForm",emits:["to-register"],setup(x,{emit:y}){const{required:i}=oe(),b=y,n=j(),a=T(),t=J(),{currentRoute:d,addRoute:s,push:c}=Q(),A={username:[i()],password:[i()]},S=W([{field:"title",colProps:{span:24},formItemProps:{slots:{default:()=>e("h2",{class:"text-2xl font-bold text-center w-[100%]"},[g("登录")])}}},{field:"username",label:"用户名",component:"Input",colProps:{span:24},componentProps:{placeholder:"admin or test"}},{field:"password",label:"密码",component:"InputPassword",colProps:{span:24},componentProps:{style:{width:"100%"},placeholder:"admin or test"}},{field:"tool",colProps:{span:24},formItemProps:{slots:{default:()=>e(_,null,[e("div",{class:"flex justify-between items-center w-[100%]"},[e(te,{modelValue:m.value,"onUpdate:modelValue":o=>m.value=o,label:"记住我",size:"small"},null),e(se,{type:"primary",underline:!1},{default:()=>[g("忘记密码")]})])])}}},{field:"login",colProps:{span:24},formItemProps:{slots:{default:()=>e(_,null,[e("div",{class:"w-[100%]"},[e(k,{loading:I.value,type:"primary",class:"w-[100%]",onClick:q},{default:()=>[g("登录")]})]),e("div",{class:"w-[100%] mt-15px"},[e(k,{class:"w-[100%]",onClick:N},{default:()=>[g("注册")]})])])}}},{field:"other",component:"Divider",label:"其它登录方式",componentProps:{contentPosition:"center"}},{field:"otherIcon",colProps:{span:24},formItemProps:{slots:{default:()=>e(_,null,[e("div",{class:"flex justify-between w-[100%]"},[e(h,{icon:"ant-design:github-filled",size:w,class:"cursor-pointer ant-icon",color:R,hoverColor:v},null),e(h,{icon:"ant-design:wechat-filled",size:w,class:"cursor-pointer ant-icon",color:R,hoverColor:v},null),e(h,{icon:"ant-design:alipay-circle-filled",size:w,color:R,hoverColor:v,class:"cursor-pointer ant-icon"},null),e(h,{icon:"ant-design:weibo-circle-filled",size:w,color:R,hoverColor:v,class:"cursor-pointer ant-icon"},null)])])}}}]),m=F(a.getRememberMe),B=()=>{const o=a.getLoginInfo;if(o){const{username:r,password:l}=o;L({username:r,password:l})}};X(()=>{B()});const{formRegister:E,formMethods:z}=H(),{getFormData:D,getElFormExpose:V,setValues:L}=z,I=F(!1),P=F("");Y(()=>d.value,o=>{var r;P.value=(r=o==null?void 0:o.query)==null?void 0:r.redirect},{immediate:!0});const q=()=>p(this,null,function*(){const o=yield V();yield o==null?void 0:o.validate(r=>p(this,null,function*(){if(r){I.value=!0;const l=yield D();try{const u=yield O(l);u&&(f(m)?a.setLoginInfo({username:l.username,password:l.password}):a.setLoginInfo(void 0),a.setRememberMe(f(m)),a.setUserInfo(u.data),n.getDynamicRouter?M():(yield t.generateRoutes("static").catch(()=>{}),t.getAddRouters.forEach(C=>{s(C)}),t.setIsAddRouters(!0),c({path:P.value||t.addRouters[0].path})))}finally{I.value=!1}}}))}),M=()=>p(this,null,function*(){const r={roleName:(yield D()).username},l=n.getDynamicRouter&&n.getServerDynamicRouter?yield $(r):yield G(r);if(l){const u=l.data||[];a.setRoleRouters(u),n.getDynamicRouter&&n.getServerDynamicRouter?yield t.generateRoutes("server",u).catch(()=>{}):yield t.generateRoutes("frontEnd",u).catch(()=>{}),t.getAddRouters.forEach(C=>{s(C)}),t.setIsAddRouters(!0),c({path:P.value||t.addRouters[0].path})}}),N=()=>{b("to-register")};return(o,r)=>(Z(),ee(f(U),{schema:S,rules:A,"label-position":"top","hide-required-asterisk":"",size:"large",class:"dark:border-1 dark:border-[var(--el-border-color)] dark:border-solid",onRegister:f(E)},null,8,["schema","onRegister"]))}});export{ge as _};
