var ae=Object.defineProperty,le=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var G=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var H=(d,o,r)=>o in d?ae(d,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):d[o]=r,E=(d,o)=>{for(var r in o||(o={}))oe.call(o,r)&&H(d,r,o[r]);if(G)for(var r of G(o))ie.call(o,r)&&H(d,r,o[r]);return d},M=(d,o)=>le(d,re(o));var m=(d,o,r)=>new Promise((S,w)=>{var N=n=>{try{p(r.next(n))}catch(c){w(c)}},A=n=>{try{p(r.throw(n))}catch(c){w(c)}},p=n=>n.done?S(n.value):Promise.resolve(n.value).then(N,A);p((r=r.apply(d,o)).next())});import{_ as O}from"./ContentWrap.vue_vue_type_script_setup_true_lang-ChG9DadK.js";import{_ as ne}from"./Table.vue_vue_type_script_lang-DcHcb_zN.js";import"./index-DGmNIDfv.js";/* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                *//* empty css                   */import{g as Q,b as se,c as de,e as ue}from"./index-D18c-NbA.js";import{u as me}from"./useTable-5Lpr0enm.js";import{_ as pe}from"./Search.vue_vue_type_script_setup_true_lang-Dkycs812.js";import{_ as ce}from"./Write.vue_vue_type_script_setup_true_lang-8FQeO66t.js";import{_ as fe}from"./Detail.vue_vue_type_script_setup_true_lang-CNjdWEWS.js";import{_ as ve}from"./Dialog.vue_vue_type_style_index_0_lang-CPAqNdc7.js";import{g as ge}from"./index-DgUO4KWQ.js";import{u as he}from"./useCrudSchemas-BFkXVgRk.js";import{_ as f}from"./Button.vue_vue_type_script_setup_true_lang-DVqcdC7i.js";import{G as ye,x as we,al as be}from"./element-plus-BuBGixiZ.js";import{y as _e,W as ke,O as i,a4 as v,I as xe,r as s,w as Ce,u as t,z as x,A as Se,L as u,D as C,Q as Ne,l as W,K as L,H as U,n as Ae}from"./vue-chunks-CaTGQ7j2.js";/* empty css                *//* empty css               *//* empty css                      *//* empty css                  *//* empty css                        */import"./el-radio-button-7PIAqI6r.js";/* empty css                  */import"./index-BKC37gAc.js";import"./Form-CZOzD3IG.js";/* empty css                     *//* empty css               *//* empty css                        *//* empty css                    */import"./InputPassword-DcSoJChw.js";import"./style.css_vue_type_style_index_0_src_true_lang-BjXzPcXs.js";import"./wang-editor-DiNEBF7K.js";import"./JsonEditor.vue_vue_type_script_setup_true_lang-CFVMa4tx.js";import"./IconPicker-Jeg92au_.js";import"./useForm-Dg0OwJE9.js";import"./useIcon-BBwH2DoJ.js";import"./useValidator-Nt61Jv1p.js";import"./Descriptions-CBakS6fi.js";import"./tree-V8lrdewf.js";const De={class:"flex w-100% h-100%"},Ve={class:"flex justify-center items-center"},Re=["title"],Te={class:"mb-10px"},kt=_e({__name:"User",setup(d){const{tableRegister:o,tableState:r,tableMethods:S}=me({fetchDataApi:()=>m(this,null,function*(){const{pageSize:a,currentPage:e}=r,l=yield se(E({id:t(h),pageIndex:t(e),pageSize:t(a)},t(z)));return{list:l.data.list||[],total:l.data.total||0}}),fetchDelApi:()=>m(this,null,function*(){return!!(yield de(t(T)))})}),{total:w,loading:N,dataList:A,pageSize:p,currentPage:n}=r,{getList:c,getElTableExpose:q,delList:J}=S,X=ke([{field:"selection",search:{hidden:!0},form:{hidden:!0},detail:{hidden:!0},table:{type:"selection"}},{field:"index",label:"序号",form:{hidden:!0},search:{hidden:!0},detail:{hidden:!0},table:{type:"index"}},{field:"username",label:"用户名"},{field:"account",label:"账号"},{field:"department.id",label:"所属部门",detail:{hidden:!0},search:{hidden:!0},form:{component:"TreeSelect",componentProps:{nodeKey:"id",props:{label:"departmentName"}},optionApi:()=>m(this,null,function*(){return(yield Q()).data.list})},table:{hidden:!0}},{field:"role",label:"角色",search:{hidden:!0},form:{component:"Select",value:[],componentProps:{multiple:!0,collapseTags:!0,maxCollapseTags:1},optionApi:()=>m(this,null,function*(){var e,l;return(l=(e=(yield ge()).data)==null?void 0:e.list)==null?void 0:l.map(j=>({label:j.roleName,value:j.id}))})}},{field:"email",label:"邮箱",form:{component:"Input"},search:{hidden:!0}},{field:"createTime",label:"创建时间",form:{component:"Input"},search:{hidden:!0}},{field:"action",label:"操作",form:{hidden:!0},detail:{hidden:!0},search:{hidden:!0},table:{width:240,slots:{default:a=>{const e=a.row;return i(xe,null,[i(f,{type:"primary",onClick:()=>K(e,"edit")},{default:()=>[v("编辑")]}),i(f,{type:"success",onClick:()=>K(e,"detail")},{default:()=>[v("详情")]}),i(f,{type:"danger",onClick:()=>P(e)},{default:()=>[v("删除")]})])}}}}]),{allSchemas:b}=he(X),z=s({}),B=a=>{n.value=1,z.value=a,c()},_=s(),h=s(""),I=s([]);m(this,null,function*(){var e,l;const a=yield Q();I.value=a.data.list,h.value=a.data.list[0]&&((e=a.data.list[0])==null?void 0:e.children)&&a.data.list[0].children[0].id||"",yield Ae(),(l=t(_))==null||l.setCurrentKey(h.value)});const D=s("");Ce(()=>D.value,a=>{t(_).filter(a)});const Y=a=>{h.value=a.id,n.value=1,c()},Z=(a,e)=>a?e.departmentName.includes(a):!0,g=s(!1),V=s(""),k=s(),y=s(""),ee=()=>{V.value="新增",k.value=void 0,g.value=!0,y.value=""},R=s(!1),T=s([]),P=a=>m(this,null,function*(){const e=yield q();T.value=a?[a.id]:(e==null?void 0:e.getSelectionRows().map(l=>l.id))||[],R.value=!0,yield J(t(T).length).finally(()=>{R.value=!1})}),K=(a,e)=>{var l;V.value=e==="edit"?"编辑":"详情",y.value=e,k.value=M(E({},a),{department:((l=t(_))==null?void 0:l.getCurrentNode())||{}}),g.value=!0},F=s(),$=s(!1),te=()=>m(this,null,function*(){const a=t(F),e=yield a==null?void 0:a.submit();if(e){$.value=!0;try{(yield ue(e))&&(n.value=1,c())}catch(l){}finally{$.value=!1,g.value=!1}}});return(a,e)=>(x(),Se("div",De,[i(t(O),{class:"w-250px"},{default:u(()=>[C("div",Ve,[e[6]||(e[6]=C("div",{class:"flex-1"},"部门列表",-1)),i(t(ye),{modelValue:D.value,"onUpdate:modelValue":e[0]||(e[0]=l=>D.value=l),class:"flex-[2]",placeholder:"搜索部门",clearable:""},null,8,["modelValue"])]),i(t(we)),i(t(be),{ref_key:"treeEl",ref:_,data:I.value,"default-expand-all":"","expand-on-click-node":!1,"node-key":"id","current-node-key":h.value,props:{label:"departmentName"},"filter-node-method":Z,onCurrentChange:Y},{default:u(({data:l})=>[C("div",{title:l.departmentName,class:"whitespace-nowrap overflow-ellipsis overflow-hidden"},Ne(l.departmentName),9,Re)]),_:1},8,["data","current-node-key","filter-node-method"])]),_:1}),i(t(O),{class:"flex-[3] ml-20px"},{default:u(()=>[i(t(pe),{schema:t(b).searchSchema,onReset:B,onSearch:B},null,8,["schema"]),C("div",Te,[i(t(f),{type:"primary",onClick:ee},{default:u(()=>e[7]||(e[7]=[v("新增")])),_:1}),i(t(f),{loading:R.value,type:"danger",onClick:e[1]||(e[1]=l=>P())},{default:u(()=>e[8]||(e[8]=[v(" 删除 ")])),_:1},8,["loading"])]),i(t(ne),{"current-page":t(n),"onUpdate:currentPage":e[2]||(e[2]=l=>W(n)?n.value=l:null),"page-size":t(p),"onUpdate:pageSize":e[3]||(e[3]=l=>W(p)?p.value=l:null),columns:t(b).tableColumns,data:t(A),loading:t(N),onRegister:t(o),pagination:{total:t(w)}},null,8,["current-page","page-size","columns","data","loading","onRegister","pagination"])]),_:1}),i(t(ve),{modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=l=>g.value=l),title:V.value},{footer:u(()=>[y.value!=="detail"?(x(),L(t(f),{key:0,type:"primary",loading:$.value,onClick:te},{default:u(()=>e[9]||(e[9]=[v(" 保存 ")])),_:1},8,["loading"])):U("",!0),i(t(f),{onClick:e[4]||(e[4]=l=>g.value=!1)},{default:u(()=>e[10]||(e[10]=[v("关闭")])),_:1})]),default:u(()=>[y.value!=="detail"?(x(),L(ce,{key:0,ref_key:"writeRef",ref:F,"form-schema":t(b).formSchema,"current-row":k.value},null,8,["form-schema","current-row"])):U("",!0),y.value==="detail"?(x(),L(fe,{key:1,"detail-schema":t(b).detailSchema,"current-row":k.value},null,8,["detail-schema","current-row"])):U("",!0)]),_:1},8,["modelValue","title"])]))}});export{kt as default};
