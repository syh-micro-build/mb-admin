var g=(u,b,c)=>new Promise((I,n)=>{var a=r=>{try{p(c.next(r))}catch(d){n(d)}},s=r=>{try{p(c.throw(r))}catch(d){n(d)}},p=r=>r.done?I(r.value):Promise.resolve(r.value).then(a,s);p((c=c.apply(u,b)).next())});import{F as O}from"./Form-CZOzD3IG.js";import{u as U}from"./useI18n-cFeKIlG0.js";import{u as K,d as T,e as W,I as h,l as $,g as G,h as H}from"./index-DGmNIDfv.js";/* empty css                    *//* empty css                */import{u as J}from"./useForm-Dg0OwJE9.js";import{y as Q,aB as X,W as Y,O as t,I as D,r as S,o as Z,w as ee,u as w,z as oe,K as te,a8 as se}from"./vue-chunks-CaTGQ7j2.js";import{u as re}from"./useValidator-Nt61Jv1p.js";import{_ as z}from"./Button.vue_vue_type_script_setup_true_lang-DVqcdC7i.js";import{D as ae,y as ne}from"./element-plus-BuBGixiZ.js";function x(u){return typeof u=="function"||Object.prototype.toString.call(u)==="[object Object]"&&!se(u)}const R=30,v="#999",y="var(--el-color-primary)",Re=Q({__name:"LoginForm",emits:["to-register"],setup(u,{emit:b}){const{required:c}=re(),I=b,n=K(),a=T(),s=W(),{currentRoute:p,addRoute:r,push:d}=X(),{t:l}=U(),E={username:[c()],password:[c()]},F=Y([{field:"title",colProps:{span:24},formItemProps:{slots:{default:()=>t("h2",{class:"text-2xl font-bold text-center w-[100%]"},[l("login.login")])}}},{field:"username",label:l("login.username"),component:"Input",colProps:{span:24},componentProps:{placeholder:"admin or test"}},{field:"password",label:l("login.password"),component:"InputPassword",colProps:{span:24},componentProps:{style:{width:"100%"},placeholder:"admin or test",onKeydown:e=>{e.key==="Enter"&&(e.stopPropagation(),A())}}},{field:"tool",colProps:{span:24},formItemProps:{slots:{default:()=>{let e;return t(D,null,[t("div",{class:"flex justify-between items-center w-[100%]"},[t(ae,{modelValue:f.value,"onUpdate:modelValue":o=>f.value=o,label:l("login.remember"),size:"small"},null),t(ne,{type:"primary",underline:!1},x(e=l("login.forgetPassword"))?e:{default:()=>[e]})])])}}}},{field:"login",colProps:{span:24},formItemProps:{slots:{default:()=>{let e,o;return t(D,null,[t("div",{class:"w-[100%]"},[t(z,{loading:P.value,type:"primary",class:"w-[100%]",onClick:A},x(e=l("login.login"))?e:{default:()=>[e]})]),t("div",{class:"w-[100%] mt-15px"},[t(z,{class:"w-[100%]",onClick:N},x(o=l("login.register"))?o:{default:()=>[o]})])])}}}},{field:"other",component:"Divider",label:l("login.otherLogin"),componentProps:{contentPosition:"center"}},{field:"otherIcon",colProps:{span:24},formItemProps:{slots:{default:()=>t(D,null,[t("div",{class:"flex justify-between w-[100%]"},[t(h,{icon:"ant-design:github-filled",size:R,class:"cursor-pointer ant-icon",color:v,hoverColor:y},null),t(h,{icon:"ant-design:wechat-filled",size:R,class:"cursor-pointer ant-icon",color:v,hoverColor:y},null),t(h,{icon:"ant-design:alipay-circle-filled",size:R,color:v,hoverColor:y,class:"cursor-pointer ant-icon"},null),t(h,{icon:"ant-design:weibo-circle-filled",size:R,color:v,hoverColor:y,class:"cursor-pointer ant-icon"},null)])])}}}]),f=S(a.getRememberMe),L=()=>{const e=a.getLoginInfo;if(e){const{username:o,password:i}=e;q({username:o,password:i})}};Z(()=>{L()});const{formRegister:V,formMethods:j}=J(),{getFormData:C,getElFormExpose:M,setValues:q}=j,P=S(!1),_=S("");ee(()=>p.value,e=>{var o;_.value=(o=e==null?void 0:e.query)==null?void 0:o.redirect},{immediate:!0});const A=()=>g(this,null,function*(){const e=yield M();yield e==null?void 0:e.validate(o=>g(this,null,function*(){if(o){P.value=!0;const i=yield C();try{const m=yield $(i);m&&(w(f)?a.setLoginInfo({username:i.username,password:i.password}):a.setLoginInfo(void 0),a.setRememberMe(w(f)),a.setUserInfo(m.data),n.getDynamicRouter?B():(yield s.generateRoutes("static").catch(()=>{}),s.getAddRouters.forEach(k=>{r(k)}),s.setIsAddRouters(!0),d({path:_.value||s.addRouters[0].path})))}finally{P.value=!1}}}))}),B=()=>g(this,null,function*(){const o={roleName:(yield C()).username},i=n.getDynamicRouter&&n.getServerDynamicRouter?yield G(o):yield H(o);if(i){const m=i.data||[];a.setRoleRouters(m),n.getDynamicRouter&&n.getServerDynamicRouter?yield s.generateRoutes("server",m).catch(()=>{}):yield s.generateRoutes("frontEnd",m).catch(()=>{}),s.getAddRouters.forEach(k=>{r(k)}),s.setIsAddRouters(!0),d({path:_.value||s.addRouters[0].path})}}),N=()=>{I("to-register")};return(e,o)=>(oe(),te(w(O),{schema:F,rules:E,"label-position":"top","hide-required-asterisk":"",size:"large",class:"dark:border-1 dark:border-[var(--el-border-color)] dark:border-solid",onRegister:w(V)},null,8,["schema","onRegister"]))}});export{Re as _};
